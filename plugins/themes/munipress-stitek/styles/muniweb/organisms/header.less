@h: ~'.header';
@hs: ~'.header__search';
@hmn: ~'.header__menu';

.header{
    border-bottom: 1px solid @border;
    position: relative;
    z-index: 10;
    .pkp_navigation_user {
        .task_count {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-left: 0.5em;
            border-radius: 50%;
            background: rgba(0,0,0,0.1);
            line-height: 20px;
            text-align: center;
            font-size: 15px; // helps visually center the number
        }

        > li > ul a {

            .task_count {
                background: #ddd;
            }

            &:hover .task_count,
                &:focus .task_count {
                background: #fff;
            }
        }

        .has_tasks {

            ul .task_count,
            ul a:hover .task_count,
                ul a:focus .task_count {
                background: #f00;
                color: #fff;
            }
        }
    }
    // reset
    &__menu{
        .js & {
            visibility: hidden;
        }
        &__primary{
            .reset-ul();
            &__item{
                .reset-ul-li();
            }
        }
        &__secondary{
            .reset-ul();
            &__item{
                .reset-ul-li();
            }
        }
        &__submenu{
            ul,
            > ul:first-child{
                .reset-ul();
            }
            &__item{
                .reset-ul-li();
            }
        }
        &__subbox{
            &__list{
                .reset-ul();
                &__item{
                    .reset-ul-li();
                }
            }
        }
    }

    // logo
    &__logo{
        margin: 0;
        a{
            display: inline-block;
            vertical-align: top;
            z-index: 1;
            position: relative;
        }
        svg{
            vertical-align: top;
        }
    }

    // lang
    &__lang{
        margin: 0;
        /*        font-size: 14px;*/
        position: absolute;
        &__selected{
            &__link,
            &__link:hover {
                display: block;
                text-decoration: none;
            }
        }
    }

    // userNav
    &__userNav{
        margin: 0;
        font-size: 15px;
        position: absolute;
        color: @primary;
        &__selected{
            &__link,
            &__link:hover {
                display: block;
                text-decoration: none;
            }
        }
    }

    // search
    &__search{
        p{
            margin: 0;
        }
    }

    // menu
    &__menu{
        .grid__cell{
            font-size: 14px;
        }
        // subbox
        &__subbox{
            text-transform: none;
            font-size: 14px;
            font-weight: normal;
            font-family: @font;
            td,
            th{
                padding: 3px 0;
            }
        }
    }

    &__menu{
        &.is-open{
            & @{hmn}{
                &-toggle{
                    visibility: visible;
                    opacity: 1;
                }
                &__title{
                    .icon{
                        &:before{
                            display: none;
                        }
                        &:after{
                            content: @fa-var-times;
                        }
                    }
                }
            }
        }

        // main toggle
        &__title{
            display: none;
            position: absolute;
            top: 57px;
            font-size: 18px;
            right: 15px;
            text-transform: uppercase;
            font-family: @fontSecondary;
            font-weight: bold;
            text-decoration: none;
            padding-left: 25px;
            z-index: 1;
            .no-touch &:hover{
                color: @muni;
            }
            .icon{
                position: absolute;
                left: 0;
                top: 50%;
                font-size: 20px;
                margin-top: -10px;
                color: @muni;
                .transform(translateZ(-1px));
            }
            .has-toggle &{
                display: block;
            }
        }

        // menu main
        &-main{
            position: absolute;
            right: 15px;
            left: 15px;
            top: 52px;
            font-weight: bold;
            margin-left: 160px;
            .has-toggle &{
                padding-right: 100px;
            }
            & @{hmn}{
                &__primary{
                    font-family: @fontSecondary;
                    text-transform: uppercase;
                    float: left;
                    font-size: 18px;
                    &__item{
                        float: left;
                        margin-left: 5px;
                        &.with-submenu,
                        &.with-subbox{
                            & @{hmn}__primary__link{
                                padding-right: 30px;
                                &:before{
                                    content: '';
                                    position: absolute;
                                    left: 0;
                                    right: 0;
                                    top: 100%;
                                    height: 10px;
                                    visibility: hidden;
                                    opacity: 0;
                                    transition: opacity .2s, background .2s;
                                    box-shadow: 3px 5px 20px rgba(0, 0, 0, 0.19);
                                    background: #fff;
                                }
                                &:after{
                                    content: '';
                                    position: absolute;
                                    left: 0;
                                    right: 0;
                                    top: 100%;
                                    height: 5px;
                                    margin-top: -5px;
                                    z-index: 100;
                                    background: #fff;
                                    opacity: 0;
                                    visibility: hidden;
                                    transition: opacity .2s, background .2s;
                                }
                            }
                            &.is-hover,
                            .no-touch &:hover{
                                & @{hmn}__primary__link{
                                    background: #fff;
                                    box-shadow: 3px 5px 20px rgba(0, 0, 0, 0.19);
                                    &:before,
                                        &:after{
                                        opacity: 1;
                                        visibility: visible;
                                    }
                                }
                            }
                        }
                        &.with-submenu{
                            position: relative;
                            &.is-hover,
                            .no-touch &:hover{
                                & @{hmn}__submenu{
                                    opacity: 1;
                                    visibility: visible;
                                }
                            }
                        }
                        &.with-subbox{
                            &.is-hover,
                            .no-touch &:hover{
                                & @{hmn}__subbox{
                                    opacity: 1;
                                    visibility: visible;
                                }

                            }
                        }

                        &--dark{
                            &.with-submenu,
                            &.with-subbox{
                                & @{hmn}__primary__link{
                                    &:before,
                                        &:after{
                                        background: #fff;
                                    }
                                }
                                &.is-hover,
                                .no-touch &:hover{
                                    & @{hmn}__primary__link{
                                        background: @muni;
                                        color: #fff;
                                        .icon{
                                            color: #fff;
                                        }
                                        &:before,
                                            &:after{
                                            background: @muni;
                                        }
                                    }
                                }
                            }
                            & @{hmn}__submenu{
                                background: @muni;
                                &__item{
                                    border-color: fade(#fff,15%);
                                }
                                &__link{
                                    color: #fff;
                                    .no-touch &:hover,
                                        &.is-active{
                                        color: #fff;
                                        background: darken(@muni, 5%);
                                    }
                                }
                            }
                            & @{hmn}__subbox{
                                background: @muni;
                                color: #fff;
                                &__title{
                                    color: #fff;
                                }
                                a{
                                    color: #fff;
                                    .no-touch &:hover{
                                        color: fade(#fff,85%);
                                    }
                                }
                                th{
                                    color: inherit;
                                }
                            }
                        }
                    }
                    &__link{
                        display: block;
                        text-decoration: none;
                        padding: 5px 15px;
                        position: relative;
                        transition: color .2s, background .2s;
                        .icon{
                            position: absolute;
                            right: 13px;
                            top: 50%;
                            font-size: 14px;
                            margin-top: -7px;
                            color: @light;
                            transition: color .2s;
                        }
                        &.is-active{
                            color: @dark;
                        }
                    }
                    &__toggle{
                        display: none;
                    }
                }
                &__secondary{
                    font-size: 14px;
                    float: right;
                    &__item{
                        float: left;
                        /*margin-left: 30px;*/
                    }
                    &__link{
                        text-decoration: none;
                        padding: 9px 0 7px;
                        display: block;
                        &.is-active{
                            color: @dark;
                        }
                    }
                    &--left{
                        float: left;
                    }
                }
                &__submenu{
                    position: absolute;
                    left: 0;
                    top: 100%;
                    background: #fff;
                    width: 270px;
                    z-index: 50;
                    margin: 10px 0 0;
                    box-shadow: 3px 5px 20px fade(#000, 19%);
                    font-size: 14px;
                    text-transform: none;
                    font-family: @font;
                    visibility: hidden;
                    opacity: 0;
                    transition: opacity .2s;
                    -webkit-font-smoothing: subpixel-antialiased;
                    &--wide {
                        width: 300px;
                    }
                    ul,
                    > ul:first-child{
                        margin: 0;
                    }
                    &__item{
                        border-top: 1px solid @border;
                        &:first-child{
                            border-top: none;
                        }
                    }
                    &__link{
                        display: block;
                        padding: 13px 20px;
                        text-decoration: none;
                        .no-touch &:hover,
                            &.is-active{
                            background: @background;
                            color: @dark;
                        }
                    }
                }
                &__subbox{
                    position: absolute;
                    left: 0;
                    right: 0;
                    top: 100%;
                    z-index: 50;
                    background: #fff;
                    box-shadow: 3px 5px 20px fade(#000, 19%);
                    margin: 10px 0 0;
                    padding: 20px;
                    visibility: hidden;
                    opacity: 0;
                    transition: opacity .2s;
                    .grid__cell{
                        > :last-child{
                            margin-bottom: 0;
                        }
                    }
                    &__close{
                        display: none;
                    }
                    &__title{
                        text-transform: uppercase;
                        font-size: 16px;
                        font-family: @fontSecondary;
                        font-weight: bold;
                        color: @dark;
                        &__link{
                            color: @dark;
                            text-decoration: none;
                            .no-touch &:hover{
                                color: @muni;
                            }
                        }
                        &__toggle{
                            display: none;
                        }
                    }
                    &__list{
                        &__item{
                            margin: 0 0 .25em;
                        }
                    }
                    &__link {
                        display: block;
                        padding: 8px 20px;
                        text-decoration: none;
                        font-weight: bold;
                        .no-touch &:hover,
                            &.is-active{
                            background: darken(@muni, 5%);
                        }
                    }
                }
            }
        }

        // menu toggle
        &-toggle{
            position: absolute;
            left: 0;
            right: 0;
            top: 100%;
            z-index: 10;
            box-shadow: 3px 5px 20px fade(#000, 19%);
            visibility: hidden;
            opacity: 0;
            transition: opacity .2s;
            overflow: hidden;
            background: #fff;
            // // padding: 15px;
            // // &:before{
            // // 	content: '';
            // // 	position: absolute;
            // // 	left: 0;
            // // 	right: 0;
            // // 	top: 15px;
            // // 	height: 1px;
            // // 	background: #fff;
            // // 	// background: @muni;
            // // }
            .header & .grid__cell{
                width: 100%;
                margin-bottom: 0;
            }

            & @{hmn}{
                &__primary,
                &__secondary,
                &__submenu{
                    &__item{
                        border-top: 1px solid fade(@muni, 15%);
                    }
                    &__link{
                        color: @muni;
                        text-decoration: none;
                        .no-touch &:hover{
                            color: @linkHover;
                        }
                    }
                }
                &__primary{
                    font-size: 16px;
                    font-family: @fontSecondary;
                    &__item{
                        &.with-submenu.is-open{
                            background: #fff;
                            position: relative;
                            // // &:before,
                            // // &:after{
                            // // 	content: '';
                            // // 	position: absolute;
                            // // 	top: 0;
                            // // 	bottom: 0;
                            // // 	width: 15px;
                            // // 	background: darken(@muni, 5%);
                            // // }
                            // // &:before{
                            // // 	right: 100%;
                            // // }
                            // // &:after{
                            // // 	left: 100%;
                            // // }
                            & @{hmn}__primary__toggle{
                                &:before{
                                    content: @fa-var-minus;
                                }
                            }
                            & @{hmn}__submenu{
                                display: block;
                            }
                        }
                        &.with-subbox.is-open{
                            & @{hmn}__subbox{
                                .transform( translateX(0) );
                            }

                        }
                        &--dark{
                            &.with-submenu.is-open{
                                background: darken(@muni, 5%);
                            }
                        }
                    }
                    &__links{
                        position: relative;
                        display: block;
                        padding-right: 50px;
                    }
                    &__link{
                        display: block;
                        padding: 13px 15px;
                        text-transform: uppercase;
                        font-weight: bold;
                        .icon{
                            display: none;
                        }
                    }
                    &__toggle{
                        position: absolute;
                        right: 0;
                        top: 0;
                        font-size: 0px;
                        height: 50px;
                        line-height: 50px;
                        width: 50px;
                        color: @muni;
                        text-align: center;
                        border-left: 1px solid fade(@muni, 15%);
                        &:after{
                            content: '';
                            position: absolute;
                            right: 100%;
                            top: 0;
                            bottom: 0;
                            width: 800px;
                        }
                        .no-touch &:hover{
                            color: @muni;
                        }
                        &:before{
                            display: inline-block;
                            vertical-align: middle;
                            font-size: 16px;
                        }
                    }

                }
                &__secondary{
                    font-size: 14px;
                    &__link{
                        font-weight: bold;
                        display: block;
                        padding: 14px 15px;
                    }
                }
                &__submenu{
                    display: none;
                    &__link{
                        display: block;
                        padding: 13px 15px 13px 30px;
                    }
                }
                &__subbox{
                    position: absolute;
                    left: 50px;
                    right: 0;
                    top: 0;
                    min-height: 100%;
                    background: #fff;
                    z-index: 1;
                    padding: 0 0 1px;
                    // padding: 15px 15px 0;
                    .transform( translateX(calc(-100% - 50px)) );
                    transition: transform .3s;
                    .grid__cell{
                        &:first-child{
                            & @{hmn}__subbox__title{
                                border: none;
                            }
                        }
                    }
                    &__toggle{
                        &.is-open{
                            & @{hmn}__subbox__box{
                                display: block;
                            }
                            & @{hmn}__subbox__title__toggle{
                                &:before{
                                    content: @fa-var-minus;
                                }
                            }
                        }
                        & @{hmn}__subbox__box{
                            display: none;
                        }
                    }
                    &__close{
                        position: absolute;
                        right: 100%;
                        width: 50px;
                        top: 0;
                        bottom: 0;
                        background: fade(darken(@muni, 5%), 90%);
                        text-align: center;
                        font-size: 0px;
                        color: #fff;
                        line-height: 50px;
                        z-index: 10;
                        &:before{
                            font-size: 16px;
                        }
                        .no-touch &:hover{
                            color: #fff;
                        }
                    }
                    &__title{
                        text-transform: uppercase;
                        font-weight: bold;
                        font-size: 16px;
                        font-family: @fontSecondary;
                        padding: 13px 0 13px 15px;
                        margin: 0;
                        border-top: 1px solid @border;
                        &.with-subitems{
                            padding-right: 50px;
                            position: relative;
                        }
                        &__link{
                            text-decoration: none;
                            display: block;
                            margin: -13px 0 -13px -15px;
                            padding: 13px 0 13px 15px;
                        }
                        &__toggle{
                            position: absolute;
                            right: 0;
                            top: 0;
                            font-size: 0px;
                            height: 51px;
                            line-height: 50px;
                            width: 50px;
                            color: @muni;
                            text-align: center;
                            border-left: 1px solid @border;
                            border-bottom: 1px solid @border;
                            .no-touch &:hover{
                                color: @muni;
                            }
                            &:before{
                                display: inline-block;
                                vertical-align: middle;
                                font-size: 16px;
                            }
                            &:after{
                                content: '';
                                position: absolute;
                                right: 100%;
                                top: 0;
                                bottom: 0;
                                width: 800px;
                            }
                        }
                    }
                    &__box{
                        padding: 0 15px;
                    }
                    &__list{
                        margin: 0 0 1.25em 0px;
                        &__item{
                            margin-top: .45em;
                            &:first-child{
                                margin-top: 0;
                            }
                        }
                    }
                }
                &__primary,
                &__secondary,
                &__submenu{
                    &__item{
                        &--dark{
                            background: @muni;
                            border-top-color: fade(#fff, 15%);
                            & @{hmn}{
                                &__primary,
                                &__secondary,
                                &__submenu,
                                &__subbox__title{
                                    &__link{
                                        color: #fff;
                                        .no-touch &:hover{
                                            color: fade(#fff, 80%);
                                        }
                                    }
                                }
                                &__primary,
                                &__subbox__title{
                                    &__toggle{
                                        color: #fff;
                                        border-color: fade(#fff, 15%);
                                        .no-touch &:hover{
                                            color: #fff;
                                        }
                                    }
                                }
                                &__submenu__item,
                                &__subbox__title{
                                    border-color: fade(#fff, 15%);
                                }
                                &__subbox{
                                    background: @muni;
                                    color: #fff;
                                    th{
                                        color: #fff;
                                    }
                                    &__link{
                                        color: #fff;
                                        .no-touch &:hover{
                                            color: fade(#fff, 80%);
                                        }
                                    }
                                    &__close{
                                        color: @muni;
                                        background: fade(#fff, 90%);
                                        .no-touch &:hover{
                                            color: @muni;
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    // hero header
    &--hero {
        border-bottom: 0;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        .background-image(linear-gradient(top, fade(#000, 100), fade(#000, 0)));
        background-image:linear-gradient(to bottom, fade(#000, 100), fade(#000, 0));
        & @{h} {
            &__lang__selected__link {
                color: #fff;
            }
            &__logo {
                path,
                polygon {
                    fill: #fff;
                }
            }
        }
        & @{hs} {
            &__label {
                color: #fff;
            }
        }
        & @{hmn} {
            &__title,
            &__secondary__link,
            &__primary__link {
                color: #fff;
                &.is-active {
                    color: #fff;
                }
                .icon {
                    color: #fff;
                }
            }
            &__primary__item {
                &.with-subbox {
                    & @{hmn} {
                        &__primary__link {
                            .no-touch &:hover {
                                color: @dark;
                                .icon {
                                    color: @dark;
                                }
                            }
                        }
                    }
                    .no-touch &:hover {
                        & @{hmn} {
                            &__primary__link {
                                color: @dark;
                                .icon {
                                    color: @dark;
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    // tablet
    @media(max-width: (716px)){
        margin: 0 0 10px;
        > .row-main{
            padding-bottom: 10px;
        }

        // logo
        &__logo{
            svg{
                height: 90px;
                width: 145px;
            }
        }

        // lang
        &__lang{
            right: 45px;
            top: 15px;
        }

        // userNav
        &__userNav{
            display:none;
        }

        // search
        &__search{
            &__label{
                position: absolute;
                right: 15px;
                top: 32px;
                color: @muni;
            }
            .inp-fix{
                position: absolute;
                left: 0;
                right: 0;
                top: 100%;
                z-index: 10;
                border: 10px solid #fff;
                margin-top: 1px;
                /*box-shadow: 0 1px 0 @border;*/
                visibility: hidden;
                opacity: 0;
                transition: opacity .2s;
            }

            &.is-open{
                & @{hs}{
                    &__label{
                        &:before{
                            content: @fa-var-times;
                        }
                    }
                }
                .inp-fix{
                    opacity: 1;
                    visibility: visible;
                }
            }
        }

        // menu
        &__menu{
            // subbox
            &__subbox{
                &--size-s-l--2,
                &--size-s-l--3,
                &--size-s-l--4,
                &--size-s-l--6{
                    .column-gap(15px);
                    .column-rule(1px, solid, fade(#fff, 50%));
                }
                &--size-s-l--2{
                    .column-count(6);

                }
                &--size-s-l--3{
                    .column-count(4);

                }
                &--size-s-l--4{
                    .column-count(3);

                }
                &--size-s-l--6{
                    .column-count(2);

                }
                &--size-s-l--1{
                    .column-count(1);

                }
                &__link {
                    display: block;
                    padding: 5px 20px;
                    text-decoration: none;
                    font-weight: bold;
                    .no-touch &:hover,
                        &.is-active{
                        background: darken(@muni, 5%);
                    }
                }
            }
        }

    }

    // tablet
    @media(min-width: 717px){
        
        // margin: 0 0 30px;
        padding: 0 0 30px;
        transition: transform .3s;
        &.headroom--pinned{
            transform: translateY(0%);
        }
        &.headroom--unpinned{
            transform: translateY(-100%);
        }

        // lang
        &__lang{
            right: 330px;
            top: 0px;
            padding-top:4px;
            font-weight: normal;
        }

        // lang
        &__userNav{
            right: 30px;
            top: 0.55em;
            line-height: 42px;
            font-weight: bold;
        }

        // search
        &__search{
            position: absolute;
            right: 25px;
            top: 70px;
            width: 285px;
            p{
                margin: 0;
            }
            .inp-fix{
                margin-top: 0;
            }
            .inp-text{
                font-size: 14px;
            }
            &__label{
                position: absolute;
                left: -5000px;
                top: -5000px;
            }
        }

        // menu
        &__menu{
            &-main{
                right: 25px;
                left: 25px;
                top: 92px;
                margin-left: 270px;
                & @{hmn}__subbox{
                    left: -270px;
                }
            }
            &-toggle{
                width: 500px;
                left: auto;
                .grid__cell{
                    width: 100%;
                }
            }
            &__title{
                right: 25px;
                top: 97px;
            }
            // subbox
            &__subbox{
                &--size-m-l--2,
                &--size-m-l--3,
                &--size-m-l--4,
                &--size-m-l--6{
                    .column-gap(15px);
                    .column-rule(1px, solid, fade(#fff, 50%));
                }
                &--size-m-l--2{
                    .column-count(6);

                }
                &--size-m-l--3{
                    .column-count(4);

                }
                &--size-m-l--4{
                    .column-count(3);

                }
                &--size-m-l--6{
                    .column-count(2);

                }
            }

        }

        // nav under header
        &--nav-under {
            padding-bottom: 10px;
            &:before {
                content: '';
                position: absolute;
                top: 146px;
                left: 0;
                right: 0;
                height: 1px;
                background: @border;
            }
            & @{hs} {
                top: 74px;
            }
            & @{h} {
                &__lang {
                    right: 25px;
                }
            }
            & @{hmn} {
                &-main {
                    padding-top: 10px;
                    margin: 7px 0 0 0;
                    position: static;
                    /*min-height: 47px;*/
                    .clearfix();
                    & @{hmn}{
                        &__primary{
                            &__item {
                                &:first-child {
                                    margin-left: 0;
                                }
                            }
                        }
                        &__secondary {
                            position: absolute;
                            top: 20px;
                            right: 110px;
                        }
                        &__subbox{
                            left: 25px;
                            right: 25px;
                        }
                    }
                }
                &__title{
                    top: auto;
                    bottom: 5px;
                }
                &-toggle{
                    margin-top: 10px;
                }
            }
        }
    }

    // tablet only
    @media(min-width: @tablet) and (max-width: (@desktop - 1)){
        .size--m--1-3{
            width: 33.333%;
            margin-bottom: 30px;
        }
    }

    // desktop
    @media(min-width: @desktop){
        // menu
        &__menu{
            &-main{
                right: 35px;
                left: 35px;
                // subbox
                & @{hmn}{
                    &__subbox{
                        padding: 30px 50px;
                    }
                }
            }
            &__title{
                right: 35px;
            }
        }

        // lang
        &__lang{
            right: 345px;
        }

        // userNav
        &__userNav{
            right: 50px;
        }

        // search
        &__search{
            right: 35px;
            top: 70px;
        }

        &__menu{
            &__subbox{
                &--size--l--2,
                &--size--l--3,
                &--size--l--4,
                &--size--l--6{
                    .column-gap(30px);
                    .column-rule(1px, solid, fade(#fff, 50%));
                }
                &--size--l--2{
                    .column-count(6);

                }
                &--size--l--3{
                    .column-count(4);

                }
                &--size--l--4{
                    .column-count(3);

                }
                &--size--l--6{
                    .column-count(2);

                }
            }
        }

        // wrap + fixed
        &-fixed-wrap{
            height: 200px;
            &.is-fixed{
                & @{h}{
                    background: #fff;
                    position: fixed;
                    padding-bottom: 10px;
                    &__logo{
                        svg{
                            height: 69px;
                            width: 101px;
                        }
                    }
                    &__lang,
                    &__search{
                        display: none;
                    }
                    &__menu-main{
                        top: 32px;
                    }
                    &__menu__title{
                        top: 37px;
                    }
                }
            }
            & @{h}{
                position: absolute;
                left: 0;
                right: 0;
                top: 0;
                z-index: 500;
            }
        }

        // nav under header
        &--nav-under {
            & @{h} {
                &__lang {
                    right: 35px;
                }
            }
            & @{hmn} {
                &-main {
                    & @{hmn}{
                        &__subbox{
                            left: 35px;
                            right: 35px;
                        }
                    }
                }
            }
        }
    }
}
